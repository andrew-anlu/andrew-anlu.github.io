
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>è‡ªå®šä¹‰AsyncDisplayKit-Node - å®‰è·¯çš„æŠ€æœ¯åšå®¢</title>
  <meta name="author" content="å®‰è·¯">

  
  <meta name="description" content="å‡è®¾ä½ å·²ç»è¯»è¿‡AsyncDisplayKitå…¥é—¨,ä¸‹é¢æˆ‘ä»¬å°†ç»§ç»­ä»‹ç»AsyncDisplayKit. è¿™ç¯‡æ•™ç¨‹å°†è§£é‡Šå¦‚ä½•å……åˆ†åˆ©ç”¨æ¡†æ¶æ¢ç´¢AsyncDisplayKitèŠ‚ç‚¹çš„å±‚æ¬¡ç»“æ„ï¼Œé€šè¿‡è¿™æ ·åšï¼Œä½ å°†ä¼šæ›´åŠ ç†Ÿæ‚‰AsyncDisplayKitè¿™ä¸ªæœ‰åçš„æ¡†æ¶ï¼Œå¹¶ä¸”ä¼šä½¿ä½ çš„appç¨‹åºå¼‚å¸¸å¹³æ»‘ï¼Œ &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://andrew-anlu.github.io/blog/2016/04/26/zi-ding-yi-asyncdisplaykit-node/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="å®‰è·¯çš„æŠ€æœ¯åšå®¢" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//libs.baidu.com/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">å®‰è·¯çš„æŠ€æœ¯åšå®¢</a></h1>
  
    <h2>Nothing in life is to be feared. It is only to be understood</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://andrew-anlu.github.io" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="andrew-anlu.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/blog/">About me</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">è‡ªå®šä¹‰AsyncDisplayKit-Node</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-04-26T15:13:13+08:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>26</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>3:13 pm</span></time>
        
           | <a href="#disqus_thread"
             data-disqus-identifier="http://andrew-anlu.github.io">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p><img src="http://7xkxhx.com1.z0.glb.clouddn.com/ASDK_NodeHierarchy.png" alt="node" /></p>

<p>å‡è®¾ä½ å·²ç»è¯»è¿‡<a href="http://andrew-anlu.github.io/blog/2016/04/15/asyndisplaykitru-men-pian/">AsyncDisplayKitå…¥é—¨</a>,ä¸‹é¢æˆ‘ä»¬å°†ç»§ç»­ä»‹ç»AsyncDisplayKit.</p>

<!--more-->


<p>è¿™ç¯‡æ•™ç¨‹å°†è§£é‡Šå¦‚ä½•å……åˆ†åˆ©ç”¨æ¡†æ¶æ¢ç´¢AsyncDisplayKitèŠ‚ç‚¹çš„å±‚æ¬¡ç»“æ„ï¼Œé€šè¿‡è¿™æ ·åšï¼Œä½ å°†ä¼šæ›´åŠ ç†Ÿæ‚‰AsyncDisplayKitè¿™ä¸ªæœ‰åçš„æ¡†æ¶ï¼Œå¹¶ä¸”ä¼šä½¿ä½ çš„appç¨‹åºå¼‚å¸¸å¹³æ»‘ï¼ŒåŒæ—¶èƒ½å¤Ÿæ„å»ºçµæ´»çš„å’Œå¯é‡ç”¨çš„ui</p>

<p>è¿™AsyncDisplayKitä¸­ä¸€ä¸ªæ ¸å¿ƒæ¦‚å¿µå°±æ˜¯<code>node</code>,æ­£å¦‚ä½ æ‰€çŸ¥ï¼ŒAsyncDisplayKit nodes æ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„æŠ½è±¡äºUIviewä¹‹ä¸Šçš„ï¼Œï¼ˆUIviewä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼‰,ä½ å¯ä»¥å­¦ä¹ æ›´å¤šAsyncDisplayKitåœ¨<a href="http://asyncdisplaykit.org/">AsyncDisplayKitâ€™s Quick Start introduction</a></p>

<p>å¥½æ¶ˆæ¯æ˜¯ä½ å·²ç»çŸ¥é“äº†UIKit,é‚£ä¹ˆä½ å·²ç»äº†è§£AsyncDisplayKitä¸€äº›å±æ€§å’Œæ–¹æ³•äº†ï¼Œå› ä¸ºAPIæ˜¯å¾ˆç›¸ä¼¼çš„ã€‚éšåï¼Œä½ å°†ä¼šå­¦åˆ°:</p>

<ul>
<li>å¦‚ä½•å»åˆ›å»ºä½ è‡ªå·±çš„ AsDisplayNode</li>
<li>å¦‚ä½•åµŒå¥—ä¸€ä¸ªnodeåˆ°ä¸€ä¸ªå•ä¸ªNodeå®¹å™¨ä¸­ï¼Œå¹¶ä¸”ç®¡ç†å’Œé‡ç”¨</li>
<li>å¦‚ä½•ç”¨ä¸€ä¸ªNodeå±‚æ¬¡ç»“æ„æ”¯æŒViewçš„å±‚æ¬¡ç»“æ„ï¼Œå› ä¸ºä½ è‡ªåŠ¨å‡å°‘åœ¨ä¸»çº¿ç¨‹ç»˜åˆ¶çš„æœºä¼šï¼Œä¿æŒä½ çš„ç•Œé¢å¹³æ»‘å’Œå“åº”</li>
</ul>


<p>ä¸‹é¢æ˜¯ä½ å°†è¦åšçš„ï¼šä½ å°†è¦åˆ›å»ºä¸€ä¸ªå®¹å™¨Node,å¹¶ä¸”æ·»åŠ ä¸¤ä¸ªå­Node-å…¶ä¸­ä¸€ä¸ªæ˜¯å›¾ç‰‡node,å…¶ä¸­ä¸€ä¸ªæ˜¯æ–‡æœ¬node,ä½ å°†ä¼šçœ‹åˆ°å®¹å™¨æ˜¯å¦‚ä½•æµ‹é‡ä»–ä»¬çš„å­Nodeå°ºå¯¸å’Œå¤§å°çš„.æœ€åï¼Œä½ å°†ä¼šè½¬åŒ–ä¸€ä¸ªå·²ç»å­˜åœ¨çš„UIviewå®¹å™¨ä¸ºä¸€ä¸ªASDisplaytNodeå­ç±»ã€‚</p>

<p>æ•ˆæœå›¾å¦‚ä¸‹:</p>

<p><img src="http://7xkxhx.com1.z0.glb.clouddn.com/ASDK_NodeHierarchies-7-e1434332214236.jpg" alt="node" /></p>

<h2>å¼€å§‹</h2>

<p>è¿™ä¸ªapp,ä½ å°†è¦åˆ›å»ºä¸€ä¸ªå¡ç‰‡å±•ç¤ºä¸–ç•Œä¸Šä¸€ä¸ªå¥‡è§‚-æ³°å§¬é™µ</p>

<p>ä¸‹è½½<a href="http://www.raywenderlich.com/wp-content/uploads/2015/06/Wonders-Starter.zip">å¼€å§‹å·¥ç¨‹</a></p>

<p>è¿™ä¸ªå·¥ç¨‹åªæœ‰ä¸€ä¸ªViewController,è¿™ä¸ªå·¥ç¨‹æ˜¯ç”¨ cocoaPodsæ„å»ºçš„ï¼Œæ‰€ä»¥ä½ å¿…é¡»å®‰è£… pods,ç„¶ååˆ›å»º Podfile,å¼•å…¥ AsyncDisplayKit.</p>

<blockquote><p><em>æ³¨æ„</em>
å¦‚æœä½ ä¸äº†è§£ Pods,è¯·å­¦ä¹ <a href="http://www.raywenderlich.com/64546/introduction-to-cocoapods-2">Introduction to CocoaPods Tutorial</a></p></blockquote>

<p>æ‰“å¼€  ViewController.swiftï¼Œç„¶åæ³¨æ„åˆ°è¿™ä¸ªview controlleråªæœ‰ä¸€ä¸ªå¸¸é‡<code>card</code>,å®ƒä¿å­˜äº†ä¸€ä¸ªæ³°å§¬é™µçš„æ¨¡å‹å¯¹è±¡ï¼Œä½ å°†ä¼šä½¿ç”¨è¿™ä¸ªæ¨¡å‹åˆ›å»ºä¸€ä¸ªå¡ç‰‡çš„nodeå»å±•ç¤ºã€‚</p>

<p>ç¼–è¯‘è¿è¡Œå·¥ç¨‹ï¼Œä½ å°†ä¼šçœ‹åˆ°ä¸€ä¸ªç©ºçš„é»‘è‰²å±å¹•
<img src="http://7xkxhx.com1.z0.glb.clouddn.com/ASDK_NodeHierarchies-1-281x500.jpg" alt="logo" /></p>

<h2>åˆ›å»ºå¹¶ä¸”æ˜¾ç¤ºä¸€ä¸ªå®¹å™¨Node</h2>

<p>ç°åœ¨ä½ è¦å¼€å§‹æ„å»ºä½ çš„ç¬¬ä¸€ä¸ªNodeå±‚æ¬¡ç»“æ„ï¼Œå®ƒæ˜¯éå¸¸ç›¸ä¼¼çš„å’Œåˆ›å»ºä¸€ä¸ªUIviewçš„å±‚æ¬¡ç»“æ„</p>

<p>æ‰“å¼€ Wonders-Bridging-Header.hï¼Œç„¶åæ·»åŠ å¦‚ä¸‹ä»£ç :</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#import &lt;AsyncDisplayKit/ASDisplayNode+Subclasses.h&gt;</span></code></pre></td></tr></table></div></figure>


<p><code>ASDisplayNode+Subclasses.h</code>æ˜¯AsDisplayNodeçš„ä¸€ä¸ªå†…éƒ¨æ–¹æ³•ï¼Œä½ éœ€è¦åœ¨<code>ASDisplayNode</code>å­ç±»ä¸­å®ç°è¿™ä¸ªheaderä¸­å®šä¹‰çš„æ–¹æ³•ï¼Œä½†æ˜¯ä½ åªèƒ½è°ƒç”¨è¿™äº›æ–¹æ³•åœ¨ä½ çš„ ASDisplayNodeçš„å­ç±»ä¸­ï¼Œè¿™æ˜¯å’Œ<code>UIGestureRecognizer</code>æ¨¡å¼å¾ˆç›¸ä¼¼çš„ã€‚</p>

<p>æ‰“å¼€CardNode.swiftï¼Œç„¶åæ·»åŠ ASDisplayNodeå­ç±»å®ç°:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class CardNode: ASDisplayNode {}</span></code></pre></td></tr></table></div></figure>


<p>å®šä¹‰äº†ä¸€ä¸ªæ–°çš„ASDisplayNodeå­ç±»ï¼Œä½ å°†ä¼šæŠŠå®ƒä½œä¸ºä¸€ä¸ªå®¹å™¨å»å¤„ç†ç”¨æˆ·çš„äº¤äº’</p>

<p>æ‰“å¼€ViewController.swift,åœ¨viewDidLoad()ä¸­å®ç°å¦‚ä¸‹:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>override func viewDidLoad() {
</span><span class='line'>  super.viewDidLoad()
</span><span class='line'>  // Create, configure, and lay out container node
</span><span class='line'>  let cardNode = CardNode()
</span><span class='line'>  cardNode.backgroundColor = UIColor(white: 1.0, alpha: 0.27)
</span><span class='line'>  let origin = CGPointZero
</span><span class='line'>  let size = CGSize(width: 100, height: 100)
</span><span class='line'>  cardNode.frame = CGRect(origin: origin, size: size)
</span><span class='line'>  // Create container nodeâ€™s view and add to view hierarchy
</span><span class='line'>  view.addSubview(cardNode.view)
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>ä¸Šé¢çš„ä»£ç åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å¡ç‰‡node,å®ƒå®šä½åœ¨å·¦ä¸Šè§’å¹¶ä¸”é«˜å®½éƒ½æ˜¯100.
ä¸ç”¨æ‹…å¿ƒä¹‹å‰çš„çº¦æŸï¼Œä½ å°†ä¼šå®šä½åˆ°ä¸­å¿ƒåœ¨è¿™ä¸ªview controllerä¸­ã€‚</p>

<p>ç¼–è¯‘è¿è¡Œ ï¼š</p>

<p><img src="http://7xkxhx.com1.z0.glb.clouddn.com/ASDK_NodeHierarchies-2-281x500.jpg" alt="logo" /></p>

<p>å¤ªå¥½äº†ï¼ä½ å·²ç»æœ‰äº†ä¸€ä¸ªè‡ªå®šä¹‰çš„nodeåœ¨å±å¹•ä¸Šæ˜¾ç¤ºï¼Œä¸‹ä¸€æ­¥æ˜¯ç»™ä½ çš„å­nodeå–åä¸º <code>CardNode</code>,å¹¶ä¸”è®¡ç®—å®ƒçš„å°ºå¯¸ã€‚åœ¨viewä¸­å±…ä¸­è¿™æ˜¯å¿…é¡»è¦çŸ¥é“çš„ï¼Œä½ åº”è¯¥ç†è§£nodeå¸ƒå±€å¼•æ“çš„å·¥ä½œåŸç†ã€‚</p>

<h2>Nodeå¸ƒå±€å¼•æ“</h2>

<p>ä¸‹ä¸€æ­¥æ˜¯è¯¢é—®Nodeå»è®¡ç®—è‡ªå·±çš„å°ºå¯¸é€šè¿‡è°ƒç”¨<code>measure(constrainedSize:)</code>,ä½ å°†ä¼šé€šè¿‡æ–¹æ³•ä¸­constrainedSizeå‚æ•°å»å‘Šè¯‰nodeå»è®¡ç®—ä¸€ä¸ªå°ºå¯¸å»é€‚åº”constrainedSize</p>

<p>é€šä¿—çš„è¯´,è¿™æ„å‘³ç€è®¡ç®—å¤§å°ä¸èƒ½å¤§äºé™åˆ¶å¤§å°ã€‚ä¾‹å¦‚,è€ƒè™‘ä¸‹é¢çš„å›¾
<img src="http://7xkxhx.com1.z0.glb.clouddn.com/ASDK_measure.png" alt="logo" /></p>

<p>è¿™ä¸ªå±•ç¤ºäº†ä¸€ä¸ªçº¦æŸçš„å°ºå¯¸ä½¿ç”¨ç¡®å®šçš„å®½åº¦å’Œé«˜åº¦ï¼Œè¿™ä¸ªè®¡ç®—å°ºå¯¸æ˜¯å’Œå®½åº¦ç›¸ç­‰çš„ï¼Œä½†æ˜¯æ¯”é«˜åº¦è¦å°ï¼Œå®ƒå¯èƒ½å’Œå®½åº¦å’Œé«˜åº¦éƒ½ç›¸ç­‰ï¼Œæˆ–è€…æ¯”å®½åº¦å’Œé«˜åº¦éƒ½è¦å°ï¼Œä½†æ˜¯å®½åº¦å’Œé«˜åº¦éƒ½ä¸å…è®¸æ¯”çº¦æŸçš„å°ºå¯¸è¦å¤§ã€‚</p>

<p>è¿™ä¸ªå·¥ä½œå’ŒUIView&rsquo;s<code>sizeThatFits(size:)</code>æ–¹æ³•å¾ˆç›¸ä¼¼ã€‚ä½†æ˜¯ä¸åŒä¹‹å¤„åœ¨äº<code>measure(constrainedSize:)</code>è®¡ç®—å®ƒçš„å°ºå¯¸ï¼Œå…è®¸ä½ è®¿é—®ç¼“å­˜
nodeçš„calculatedSizeå±æ€§ã€‚</p>

<p>ä¸€ä¸ªä¾‹å­å°±æ˜¯å½“è®¡ç®—çš„é«˜åº¦å’Œå®½åº¦çš„å°ºå¯¸æ¯”çº¦æŸå°ºå¯¸æ›´å°çš„æ—¶å€™ï¼š
<img src="http://7xkxhx.com1.z0.glb.clouddn.com/ASDK_constrained2.png" alt="lgo" /></p>

<p>è¿™é‡Œå›¾ç‰‡çš„å°ºå¯¸æ˜¯æ›´å°æ¯”çº¦æŸçš„å°ºå¯¸ï¼Œæ²¡æœ‰ä»»ä½•çš„sizing-to-fitï¼Œè¿™é‡Œè®¡ç®—çš„å°ºå¯¸æ¯”çº¦æŸå°ºå¯¸æ›´å°ã€‚</p>

<p>åŸå› å°±æ˜¯AsyncDisplayKitç»å¸¸éœ€è¦èŠ±è´¹æ—¶é—´å»è®¡ç®—å°ºå¯¸ï¼Œè¯»å–ä¸€ä¸ªå›¾ç‰‡ä»ç¡¬ç›˜ä¸­ï¼Œå¯èƒ½ä¼šéå¸¸æ…¢ï¼Œé€šè¿‡åˆå¹¶å°ºå¯¸åˆ°nodeApi,è¿™ä¸ªæ˜¯çº¿ç¨‹å®‰å…¨çš„æ“ä½œï¼Œè¿™æ„å‘³ç€è®¡ç®—å°ºå¯¸å¯ä»¥åœ¨åå°çº¿ç¨‹ä¸­è¿è¡Œï¼ä¼˜é›…çš„ï¼å®ƒæ˜¯ä¸€ä¸ªæœ‰ç”¨çš„ç‰¹æ€§è®©ä½ çš„UIç¨‹åºå¹³æ»‘å¦‚é»„æ²¹ä¸€èˆ¬ã€‚</p>

<p>ä¸€ä¸ªNodeå°†ä¼šè¿è¡Œè®¡ç®—å°ºå¯¸åŠ å…¥å®ƒæ²¡æœ‰å­˜å‚¨å€¼çš„è¯ï¼Œå‡å¦‚è¿™ä¸ªçº¦æŸå°ºå¯¸æä¾›æ˜¯ä¸åŒçš„ï¼Œçº¦æŸå°ºå¯¸å¸¸å¸¸å†³å®šç¼“å­˜çš„è®¡ç®—å¤§å°ã€‚</p>

<p>åœ¨ç¨‹åºä¸­ï¼Œå·¥ä½œå¦‚ä¸‹:</p>

<ul>
<li>measure(constrainedSize:)è¿”å›ä¸€ä¸ªå­˜å‚¨ä½ çš„å°ºå¯¸æˆ–è€…è¿›è¡Œä¸€ä¸ªè®¡ç®—å°ºå¯¸é€šè¿‡è°ƒç”¨calculateSizeThatFits(constrainedSize:)</li>
<li>ä½ æ›¿æ¢æ‰€æœ‰çš„å°ºå¯¸è®¡ç®—é€šè¿‡<code>calculateSizeThatFits(constrainedSize:)</code>åœ¨ä½ çš„ASDisplayNodeå­ç±»ä¸­</li>
</ul>


<blockquote><p><em>æ³¨æ„</em>
calculateSizeThatFits(constrainedSize:)æ˜¯ASDisplayNodeçš„å†…éƒ¨æ–¹æ³•ï¼Œä½ ä¸åº”è¯¥åœ¨å¤–éƒ¨è°ƒç”¨å®ƒ</p></blockquote>

<h2>æµ‹é‡Nodeçš„å¤§å°</h2>

<p>ç°åœ¨æ˜¯æ—¶å€™æµ‹é‡ä½ çš„è‡ªå·±çš„nodeå¤§å°äº†ã€‚</p>

<p>æ‰“å¼€CardNode.swift,ç„¶åæ›¿æ¢è¿™ä¸ªç±»ä¸­çš„ä»£ç :</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class CardNode: ASDisplayNode {
</span><span class='line'> 
</span><span class='line'>  override func calculateSizeThatFits(constrainedSize: CGSize) -&gt; CGSize {
</span><span class='line'>    return CGSize(width: constrainedSize.width * 0.2, height: constrainedSize.height * 0.2)
</span><span class='line'>  }
</span><span class='line'> 
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>åˆ°ç°åœ¨ä¸ºæ­¢ï¼Œè¿™ä¸ªæ–¹æ³•è¿”å›çš„å¤§å°æ˜¯çº¦æŸæä¾›å°ºå¯¸çš„20%.</p>

<p>æ‰“å¼€ViewController.swift,åˆ é™¤viewDidLoad() ä¸­çš„å®ç°ï¼Œç„¶åå®ç°ä¸‹é¢çš„<code>createCardNode(containerRect:)</code>æ–¹æ³•:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/* Delete this method
</span><span class='line'> 
</span><span class='line'>override func viewDidLoad() {
</span><span class='line'>  super.viewDidLoad()
</span><span class='line'>  // 1
</span><span class='line'>  let cardNode = CardNode()
</span><span class='line'>  cardNode.backgroundColor = UIColor(white: 1.0, alpha: 0.27)
</span><span class='line'>  let origin = CGPointZero
</span><span class='line'>  let size = CGSize(width: 100, height: 100)
</span><span class='line'>  cardNode.frame = CGRect(origin: origin, size: size)
</span><span class='line'> 
</span><span class='line'>  // 2
</span><span class='line'>  view.addSubview(cardNode.view)
</span><span class='line'>}
</span><span class='line'>*/
</span><span class='line'> 
</span><span class='line'>func createCardNode(#containerRect: CGRect) -&gt; CardNode {
</span><span class='line'>  // 3
</span><span class='line'>  let cardNode = CardNode()
</span><span class='line'>  cardNode.backgroundColor = UIColor(white: 1.0, alpha: 0.27)
</span><span class='line'>  cardNode.measure(containerRect.size)
</span><span class='line'> 
</span><span class='line'>  // 4
</span><span class='line'>  let size = cardNode.calculatedSize
</span><span class='line'>  let origin = containerRect.originForCenteredRectWithSize(size)
</span><span class='line'>  cardNode.frame = CGRect(origin: origin, size: size)
</span><span class='line'>  return cardNode
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>ä¸Šé¢çš„ä»£ç åšçš„å·¥ä½œå¦‚ä¸‹:</p>

<ol>
<li>åˆ é™¤ä¹‹å‰åˆ›å»ºçš„ä»£ç ï¼Œé…ç½®å’Œå¸ƒå±€ä»£ç </li>
<li>åˆ é™¤ä¹‹å‰çš„ä»£ç ï¼ŒæŠŠnodeåŠ å…¥åˆ°viewçš„å±‚æ¬¡ç»“æ„ä¸­</li>
<li>createCardNode(containerRect:) åˆ›å»ºäº†ä¸€ä¸ªå¡ç‰‡Nodeä½¿ç”¨ç›¸åŒçš„èƒŒæ™¯é¢œè‰²å’Œå®¹å™¨node,å®ƒç”¨ä½œä¸€ä¸ªå®¹å™¨å»çº¦æŸå¡ç‰‡nodeçš„å¤§å°ï¼Œæ‰€ä»¥è¿™ä¸ªå¡ç‰‡Nodeä¸èƒ½æ¯”containerRectâ€™çš„å°ºå¯¸æ›´å¤§</li>
<li>é€šè¿‡originForCenteredRectWithSize(size:) æ–¹æ³•è®¾ç½®å¡ç‰‡åˆ°ä¸­å¿ƒä½ç½®ã€‚</li>
</ol>


<p>å®šä½åˆ°createCardNode(containerRect:) è¿™ä¸ªæ–¹æ³•ï¼Œæ›¿æ¢viewDidLoad():</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>override func viewDidLoad() {
</span><span class='line'>  super.viewDidLoad()
</span><span class='line'>  let cardNode = createCardNode(containerRect: UIScreen.mainScreen().bounds)
</span><span class='line'>  view.addSubview(cardNode.view)
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>å½“è§†å›¾åŠ è½½çš„æ—¶å€™ï¼ŒcreateCardNode(containerRect:)åˆ›å»ºä¸€ä¸ªæ–°çš„CardNode,è¿™ä¸ªå¡ç‰‡çš„Nodeä¸èƒ½æ¯”ä¸»å±å¹•çš„boundså°ºå¯¸æ›´å¤§ã€‚</p>

<p>åœ¨è¿™ä¸ªè§‚ç‚¹ä¸­ï¼Œè¿™ä¸ªViewControllerçš„è§†å›¾è¿˜æ²¡æœ‰åŠ è½½å‡ºæ¥ï¼Œå› æ­¤ï¼Œå®ƒä¸æ˜¯å®‰å…¨çš„å¯¹ç”¨äºViewContrllerçš„boundså°ºå¯¸ã€‚æ‰€ä»¥ä½ ä½¿ç”¨ä¸»å±å¹•çš„å°ºå¯¸å»çº¦æŸå¡ç‰‡Nodeçš„å¤§å°ã€‚</p>

<p>è¿è¡Œèµ·æ¥ï¼Œå°½ç®¡è¾¾ä¸åˆ°ä¼˜é›…ï¼Œå› ä¸ºè¿™ä¸ªè§†å›¾æ§åˆ¶å™¨æ¨ªè·¨äº†æ•´ä¸ªå±å¹•ï¼Œç¨åï¼Œæˆ‘ä»¬å°†æ·»åŠ é€‚å½“çš„æ–¹æ³•ï¼Œç°åœ¨ï¼Œå®ƒå·¥ä½œè¿˜å¯ä»¥ã€‚</p>

<p>ç¼–è¯‘è¿è¡Œï¼Œä½ å°†ä¼šçœ‹åˆ°ä½ çš„nodeåœ¨æ­£ä¸­å¿ƒäº†.
<img src="http://7xkxhx.com1.z0.glb.clouddn.com/ASDK_NodeHierarchies-3-281x500.jpg" alt="logo" /></p>

<h2>å¼‚æ­¥èŠ‚ç‚¹è®¾ç½®å’Œå¸ƒå±€</h2>

<p>æœ‰æ—¶å®ƒä¼šèŠ±è´¹äººä»¬å¾ˆå¤šæ—¶é—´å»è§£æå¤æ‚çš„å±‚æ¬¡ç»“æ„ï¼Œå‡å¦‚è¿™æ˜¯åœ¨ä¸»çº¿ç¨‹å‘ç”Ÿï¼Œè¿™å°†ä¼šé˜»å¡ä¸»çº¿ç¨‹ï¼Œå‡å¦‚ä½ æƒ³å–æ‚¦ç”¨æˆ·çš„è¯ï¼Œä½ ä¸èƒ½è®©ç”¨æˆ·ä¸€ç›´ç­‰å¾…ï¼Œä¹‹å‰ç”¨æˆ·æ˜¯ä¸èƒ½å’Œç¨‹åºæœ‰ä»»ä½•äº¤äº’çš„ã€‚</p>

<p>å› ä¸ºè¿™ä¸ªåŸå› ï¼Œä½ å°†ä¼šåœ¨åå°çº¿ç¨‹åˆ›å»ºè®¾ç½®nodesï¼Œè¿™æ ·ä½ èƒ½é¿å…é˜»å¡ä¸»çº¿ç¨‹ã€‚</p>

<p>åœ¨createCardNode(containerRect:)å’ŒviewDidLoad():ä¸­å®ç°addCardViewAsynchronously(containerRect:)</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>func addCardViewAsynchronously(#containerRect: CGRect) {
</span><span class='line'>  dispatch_async(dispatch_get_global_queue(QOS_CLASS_BACKGROUND, 0)) {
</span><span class='line'>    let cardNode = self.createCardNode(containerRect: containerRect)
</span><span class='line'>    dispatch_async(dispatch_get_main_queue()) {
</span><span class='line'>      self.view.addSubview(cardNode.view)
</span><span class='line'>    }
</span><span class='line'>  }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p><code>addCardViewAsynchronously(containerRect:)</code>åˆ›å»ºè¿™ä¸ª<code>CardNode</code>åœ¨ä¸€ä¸ªçº¿ç¨‹é˜Ÿåˆ—ä¸­ï¼Œè¿™æ˜¯å¾ˆå¥½çš„ï¼Œå› ä¸ºnodesæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼åˆ›å»ºå¥½ä¹‹åï¼Œé…ç½®è¿™ä¸ªNode,ç„¶åå¼‚æ­¥è°ƒç”¨ä¸»çº¿ç¨‹æŠŠNodeæ·»åŠ åˆ°è§†å›¾æ§åˆ¶å™¨ä¸­&ndash;æ¯•ç«Ÿï¼ŒUIKitä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼</p>

<blockquote><p><em>æ³¨æ„</em>
ä¸€æ—¦ä½ åˆ›å»ºäº†Nodeçš„è§†å›¾ï¼Œæ‰€æœ‰è®¿é—®nodeçš„èŠ‚ç‚¹åªåœ¨ä¸»çº¿ç¨‹</p></blockquote>

<p>é‡æ–°å®ç°viewDidLoad()é€šè¿‡è°ƒç”¨<code>addCardViewAsynchronously(containerRect:):</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>override func viewDidLoad() {
</span><span class='line'>  super.viewDidLoad()
</span><span class='line'>  addCardViewAsynchronously(containerRect: UIScreen.mainScreen().bounds)
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>è¿™å°†ä¸å†é˜»å¡ä¸»çº¿ç¨‹ï¼Œç¡®ä¿ç”¨æˆ·ç•Œé¢æ˜¯å¯ä»¥éšæ—¶å“åº”çš„ã€‚</p>

<p>ç¼–è¯‘è¿è¡Œï¼Œå’Œä¹‹å‰ä¸€æ ·ï¼Œä¸è¿‡æ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯åœ¨åå°çº¿ç¨‹æ‰§è¡Œçš„</p>

<p><img src="http://7xkxhx.com1.z0.glb.clouddn.com/ASDK_NodeHierarchies-3-281x500.jpg" alt="logo" /></p>

<h2>çº¦æŸèŠ‚ç‚¹å¤§å°</h2>

<p>è®°å¾—ä¹‹å‰æˆ‘ä½ ä¼šä½¿ç”¨ä¸€ä¸ªæ›´ä¼˜é›…çš„è§£å†³æ–¹æ¡ˆèŠ‚ç‚¹ä¸ä»…ä»…ä¾é å±å¹•å°ºå¯¸çš„å¤§å°
?ç°åœ¨æˆ‘æ¥å…‘æ¢æˆ‘çš„è¯ºè¨€</p>

<p>æ‰“å¼€ ViewController.swiftï¼Œæ·»åŠ ä¸‹é¢çš„å±æ€§ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>var cardViewSetupStarted = false</span></code></pre></td></tr></table></div></figure>


<p>ç„¶åæ›¿æ¢viewDidLoad()ä¸ºviewWillLayoutSubviews():</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/* Delete this method
</span><span class='line'>override func viewDidLoad() {
</span><span class='line'>  super.viewDidLoad()
</span><span class='line'>  addCardViewAsynchronously(containerRect: UIScreen.mainScreen().bounds)
</span><span class='line'>}
</span><span class='line'>*/
</span><span class='line'> 
</span><span class='line'>override func viewWillLayoutSubviews() {
</span><span class='line'>  super.viewWillLayoutSubviews()
</span><span class='line'>  if !cardViewSetupStarted {
</span><span class='line'>    addCardViewAsynchronously(containerRect: view.bounds)
</span><span class='line'>    cardViewSetupStarted = true
</span><span class='line'>  }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>æ›¿æ¢æ‰äº†ä½å±å¹•çš„å°ºå¯¸ï¼Œè¿™ä¸Šé¢çš„é€»è¾‘æ˜¯è§†å›¾æ§åˆ¶å™¨çš„å°ºå¯¸å»çº¦æŸå¡ç‰‡çš„å°ºå¯¸ã€‚</p>

<p>ç°åœ¨å®ƒæ˜¯çº¿ç¨‹å®‰å…¨çš„,å»ç”¨è¿™ä¸ªè§†å›¾æ§åˆ¶å™¨çš„å°ºå¯¸ï¼Œå½“viewWillLayoutSubviews()æ›¿æ¢è°ƒviewDidLoad()ã€‚è¿™ä¸€æ¬¡åœ¨è¿™ä¸ªå£°æ˜å‘¨æœŸä¸­ï¼Œè¿™ä¸ªè§†å›¾æ§åˆ¶å™¨å·²ç»è®¾ç½®å¥½äº†å®ƒçš„å°ºå¯¸ã€‚</p>

<p>è¿™ç§åŠ è½½æ–¹å¼æ˜¯å¾ˆå‡ºä¼—çš„ï¼Œå› ä¸ºä¸€ä¸ªè§†å›¾æ§åˆ¶å™¨èƒ½è¢«è®¾ç½®ä»»ä½•å°ºå¯¸,ä½ ä¸æƒ³ä¾èµ–è§†å›¾æ§åˆ¶å™¨å»æ¨ªè·¨æ•´ä¸ªå±å¹•</p>

<p><img src="http://www.raywenderlich.com/wp-content/uploads/2015/06/screen_size_tyranny.png" alt="log" /></p>

<p>è¿™ä¸ªè§†å›¾å¯èƒ½ä¼šåŠ è½½å¤šæ¬¡ï¼Œæ‰€ä»¥viewWillLayoutSubviews()èƒ½è¢«è°ƒç”¨å¤šæ¬¡ï¼Œä½ ä»…ä»…æƒ³åˆ›å»ºè¿™ä¸ªCardNodeä¸€æ¬¡ï¼Œæ‰€ä»¥è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä½ éœ€è¦ä¸€ä¸ªcardViewSetupStartedæ ‡è¯†å»è¯æ˜è¿™ä¸ªè§†å›¾æ§åˆ¶åˆ›å»ºå¤šæ¬¡ã€‚</p>

<p>ç¼–è¯‘è¿è¡Œï¼š</p>

<p><img src="http://7xkxhx.com1.z0.glb.clouddn.com/ASDK_NodeHierarchies-3-281x500.jpg" alt="logo" /></p>

<h2>Nodeå±‚æ¬¡ç»“æ„</h2>

<p>ç°åœ¨ä½ æœ‰ä¸€ä¸ªç©ºçš„Nodeå®¹å™¨åœ¨å±å¹•ä¸Šï¼Œç°åœ¨ä½ æƒ³å±•ç¤ºä¸€äº›å†…å®¹ï¼Œæ–¹å¼çš„å°±æ˜¯ä½ æ·»åŠ ä¸€äº›å­nodeåˆ°è¿™ä¸ªNodeå®¹å™¨ä¸­ï¼Œä¸‹é¢çš„ç»“æ„å›¾å±•ç¤ºäº†ç®€å•çš„Nodeç»“æ„å›¾</p>

<p><img src="http://7xkxhx.com1.z0.glb.clouddn.com/ASDK_Nodes.png" alt="node" /></p>

<p>æ·»åŠ å­Nodeçœ‹èµ·æ¥å°†ä¼šéå¸¸åƒä½ åœ¨UIviewä¸­æ·»åŠ å­Viewçš„è¿‡ç¨‹ã€‚</p>

<p>ç¬¬ä¸€æ­¥ä½ éœ€è¦æ·»åŠ ä¸€ä¸ªå›¾ç‰‡çš„node,ä½†æ˜¯é¦–å…ˆä½ çš„éœ€è¦äº†è§£å®¹å™¨Nodeæ˜¯å¦‚ä½•å¸ƒå±€å­Nodeçš„ã€‚</p>

<h2>å­Nodeçš„å¸ƒå±€</h2>

<p>ä½ ç°åœ¨çŸ¥é“äº†å¦‚ä½•å»æµ‹é‡å®¹å™¨çš„å°ºå¯¸å’Œå¦‚ä½•å»è®¡ç®—å®¹å™¨å°ºå¯¸å»å¸ƒå±€å®¹å™¨å†…çš„nodeè§†å›¾ï¼Œä½†æ˜¯è¿™ä¸ªå®¹å™¨nodeæ˜¯å¦‚ä½•å¸ƒå±€å®ƒä»¬çš„å­Nodeå‘¢ï¼Ÿ</p>

<p>æœ‰ä»¥ä¸‹ä¸¤æ­¥:</p>

<ol>
<li>ç¬¬ä¸€ï¼Œä½ æµ‹é‡æ¯ä¸ªå­Nodeçš„å°ºå¯¸åœ¨<code>calculateSizeThatFits(constrainedSize:).</code>ä¸­ï¼Œè¿™å°†ç¡®ä¿æ¯ä¸€ä¸ªå­Nodeéƒ½ç¼“å­˜ä¸€ä¸ªè®¡ç®—å¥½çš„å°ºå¯¸</li>
<li>åœ¨UIKItçš„ä¸»çº¿ç¨‹å¸ƒå±€ä¸­ï¼ŒAsyncDisplayKitå°†ä¼šè°ƒç”¨<code>layout()</code>åœ¨ä½ çš„è‡ªå®šä¹‰çš„ASDisplayNodeå­ç±»ä¸­ï¼Œ<code>layout()</code>çš„å·¥ä½œå°±åƒUIviewçš„ <code>layoutSubivews()</code>ï¼Œé™¤äº†è¿™ä¸ª<code>layout()</code>ä¸ä¼šè®¡ç®—æ‰€æœ‰å­è§†å›¾çš„å°ºå¯¸ï¼Œå¸ƒå±€()ç®€å•æŸ¥è¯¢è®¡ç®—æ¯ä¸ªèŠ‚ç‚¹çš„å¤§å°</li>
</ol>


<p>å›åˆ°UIä¸Šï¼Œè¿™ä¸ªæ³°å§¬é™µå¡ç‰‡å°ºå¯¸å°†ä¼šå’Œå®ƒçš„å›¾ç‰‡å¤§å°ä¸€æ ·ï¼Œå¹¶ä¸”è¿™ä¸ªæ ‡é¢˜å°†ä¼šé€‚åˆå®ƒçš„å¤§å°ã€‚æœ€ç®€å•çš„æ–¹å¼å°±æ˜¯å»æµ‹é‡è¿™ä¸ª<code>æ³°å§¬é™µå›¾ç‰‡</code>nodeçš„å¤§å°å¹¶ä¸”ä½¿ç”¨è¿™ä¸ªç»“æœå»çº¦æŸæ–‡æœ¬nodeçš„å°ºå¯¸ï¼Œæ‰€ä»¥è¿™ä¸ªæ–‡æœ¬nodeå°†ä¼šé€‚åˆå›¾ç‰‡å°ºå¯¸çš„å¤§å°</p>

<p>æ¥ä¸‹æ¥ï¼Œä½ å°†è¦ä½¿ç”¨lay outå»å¸ƒå±€ä½ çš„å¡ç‰‡å­Node,è®©æˆ‘ä»¬å¼€å§‹</p>

<h2>æ·»åŠ ä¸€ä¸ªå­Node</h2>

<p>æ‰“å¼€CardNode.swift,ç„¶åæ·»åŠ ä¸‹é¢çš„ä»£ç åœ¨CardNode</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>// 1
</span><span class='line'>let imageNode: ASImageNode
</span><span class='line'> 
</span><span class='line'>// 2
</span><span class='line'>init(card: Card) {
</span><span class='line'>  imageNode = ASImageNode()
</span><span class='line'>  super.init()
</span><span class='line'>  setUpSubnodesWithCard(card)
</span><span class='line'>  buildSubnodeHierarchy()
</span><span class='line'>}
</span><span class='line'> 
</span><span class='line'>// 3
</span><span class='line'>func setUpSubnodesWithCard(card: Card) {
</span><span class='line'>  // Set up image node
</span><span class='line'>  imageNode.image = card.image
</span><span class='line'>}
</span><span class='line'> 
</span><span class='line'>// 4
</span><span class='line'>func buildSubnodeHierarchy() {
</span><span class='line'>  addSubnode(imageNode)
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>ä¸Šé¢çš„ä»£ç åšçš„å·¥ä½œå¦‚ä¸‹:</p>

<ol>
<li>å›¾ç‰‡Nodeå±æ€§:è¿™è¡Œä»£ç æ·»åŠ ä¸€ä¸ªå›¾ç‰‡Nodeçš„å±æ€§ï¼Œå»å¼•ç”¨å¡ç‰‡å›¾åƒçš„å­Node</li>
<li>åˆå§‹åŒ–:è¿™ä¸ªè®¾è®¡çš„åˆå§‹åŒ–ä½¿ç”¨ä¸€ä¸ªå¡ç‰‡æ¨¡å‹ä¿å­˜å¡ç‰‡çš„å›¾åƒå’Œæ–‡æœ¬</li>
<li>è®¾ç½®å­Node:è¿™ä¸ªæ–¹æ³•ä½¿ç”¨å¡ç‰‡æ¨¡å‹çš„å›¾åƒå»ä¿å­˜å¼€å§‹é¡¹ç›®ä¸­çš„å­Nodeå›¾ç‰‡</li>
<li>å®¹å™¨å±‚æ¬¡ç»“æ„:ä½ è®¾ç½®Nodeçš„å±‚æ¬¡ç»“æ„å°±åƒä½ èƒ½è®¾ç½®è§†å›¾çš„å±‚æ¬¡ç»“æ„ä¸€æ ·ï¼Œè¿™ä¸ªæ–¹æ³•åˆ›å»ºå¡ç‰‡çš„å±‚æ¬¡ç»“æ„é€šè¿‡æ·»åŠ ä¸€ä¸ªå­Nodeæ¥å®ç°ã€‚</li>
</ol>


<p>ä¸‹ä¸€æ­¥ï¼Œå®ç°calculateSizeThatFits(constrainedSize:):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>override func calculateSizeThatFits(constrainedSize: CGSize) -&gt; CGSize {
</span><span class='line'>  // 1 
</span><span class='line'>  imageNode.measure(constrainedSize)
</span><span class='line'> 
</span><span class='line'>  // 2 
</span><span class='line'>  let cardSize = imageNode.calculatedSize
</span><span class='line'> 
</span><span class='line'>  // 3 
</span><span class='line'>  return cardSize
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>ä¸Šé¢çš„ä»£ç åšçš„å·¥ä½œå¦‚ä¸‹:</p>

<ol>
<li>è¿™ä¸ªå¡ç‰‡çš„å°ºå¯¸å°±ä¼šåŒ¹é…èƒŒæ™¯å›¾ç‰‡çš„å¤§å°ï¼Œè¿™ä¸ªæµ‹é‡èƒŒæ™¯å›¾ç‰‡çš„å°ºå¯¸ä¼šé€‚åˆå†…åµŒçš„çº¦æŸå°ºå¯¸ï¼Œæ‰€æœ‰Nodeçš„å­ç±»éƒ½ä¼šè¢«AsyncDisplayæ¡†æ¶æ„ŸçŸ¥å¹¶ä¸”çŸ¥é“å¦‚ä½•è®¾ç½®å®ƒä»¬çš„å°ºå¯¸ï¼ŒåŒ…æ‹¬AsImageNode</li>
<li>è¿™è¡Œä»£ç ä¸´æ—¶å­˜å‚¨å›¾ç‰‡è®¡ç®—çš„å°ºå¯¸ï¼Œç‰¹åˆ«è¯´æ˜çš„æ˜¯ï¼Œå®ƒä½¿ç”¨å›¾ç‰‡Nodeæµ‹é‡å°ºå¯¸æ­£å¦‚å¡ç‰‡Nodeå°ºå¯¸å»çº¦æŸå­NOdeï¼Œå½“æ·»åŠ æ›´å¤šçš„å­Nodeçš„æ—¶å€™ï¼Œä½ å°†ä¼šä½¿ç”¨è¿™ä¸ªå€¼</li>
<li>è¿”å›è¿™ä¸ªå¡ç‰‡Nodeçš„è®¡ç®—å¥½çš„å°ºå¯¸</li>
</ol>


<p>ä¸‹ä¸€æ­¥ï¼Œè¦†ç›–layout():</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>override func layout() {
</span><span class='line'>  imageNode.frame =
</span><span class='line'>    CGRect(origin: CGPointZero, size: imageNode.calculatedSize).integerRect
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>è¿™ä¸ªå›¾ç‰‡çš„é€»è¾‘ä½ç½®åœ¨å·¦ä¸Šè§’ï¼Œåæ ‡è½´åŸç‚¹ï¼Œå®ƒä¹Ÿç¡®ä¿äº†è¿™ä¸ªå›¾ç‰‡Nodeçš„frameæ²¡æœ‰ä»»ä½•å¤šä½™çš„å€¼ï¼Œæ‰€ä»¥ä½ èƒ½é¿å…åƒç´ è¾¹ç•Œæ˜¾ç¤ºé—®é¢˜</p>

<p>æ³¨æ„è¿™ä¸ªæ–¹æ³•æ˜¯å¦‚ä½•ä½¿ç”¨å›¾ç‰‡çš„Nodeå»ç¼“å­˜è®¡ç®—å°ºå¯¸çš„åœ¨å¸ƒå±€çš„è¿‡ç¨‹ä¸­ã€‚</p>

<p>å› ä¸ºè¿™ä¸ªå›¾ç‰‡Nodeçš„å°ºå¯¸å†³å®šäº†å¡ç‰‡Nodeçš„å°ºå¯¸ï¼Œè¿™ä¸ªå›¾ç‰‡å°†ä¼šæ¨ªè·¨è¿™ä¸ªå¡ç‰‡</p>

<p>å›åˆ°ViewController.swiftï¼Œç„¶åæ·»åŠ ä¸€ä¸ªcreateCardNode(containerRect:), æ›¿æ¢åˆ°ä¹‹å‰åˆå§‹åŒ–çš„<code>CardNode</code>ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>let cardNode = CardNode(card: card)</span></code></pre></td></tr></table></div></figure>


<p>è¿™è¡Œä»£ç ä½¿ç”¨æ–°çš„åˆå§‹åŒ–å»æ·»åŠ ä¸€ä¸ªå¡ç‰‡Node,è¿™ä¸ªå¡ç‰‡å€¼å°†ä¼šåœ¨åˆå§‹åŒ–çš„æ—¶å€™è¢«ä¼ å…¥ï¼Œå¹¶ä¸”å­˜å‚¨è¿™ä¸ªæ³°å§¬é™µçš„å¡ç‰‡æ¨¡å‹</p>

<p>ç¼–è¯‘è¿è¡Œ:
<img src="http://7xkxhx.com1.z0.glb.clouddn.com/ASDK_NodeHierarchies-6-281x500.jpg" alt="t" /></p>

<p>æ¼‚äº®ï¼Œä½ æˆåŠŸçš„åˆ›å»ºäº†å®¹å™¨Nodeå¹¶ä¸”å‘ˆç°äº†Nodeçš„å±‚æ¬¡ç»“æ„ï¼Œå½“ç„¶ï¼Œè¿™ä¸ªå¾ˆç®€å•ï¼Œä½†æ˜¯å®ƒæ˜¯ä¸€ä¸ªå®Œæˆçš„Nodeå±‚æ¬¡ï¼</p>

<h2>æ·»åŠ æ›´å¤šçš„å­Node</h2>

<p>ä¹Ÿè®¸ä½ å·²ç»æ³¨æ„åˆ°äº†ï¼Œæ²¡æœ‰æ·»åŠ æ ‡é¢˜ï¼Œä¸ç”¨æ‹…å¿ƒï¼Œè®©æˆ‘ä»¬å¼€å§‹æ·»åŠ å§ã€‚</p>

<p>æ‰“å¼€CardNode.swiftï¼Œç„¶åæ·»åŠ ä¸‹é¢çš„å±æ€§titleTextNodeåœ¨ç±»ä¸­ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>let titleTextNode: ASTextNode</span></code></pre></td></tr></table></div></figure>


<p>åœ¨<code>init(card:)</code>æ–¹æ³•ä¸­åˆå§‹åŒ–<code>titleTextNode</code>ï¼Œåœ¨super.init()è¿™è¡Œä»£ç ä¹‹å‰:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>titleTextNode = ASTextNode()</span></code></pre></td></tr></table></div></figure>


<p>æ·»åŠ ä¸‹é¢çš„è¿™è¡Œä»£ç åœ¨<code>setUpSubnodesWithCard(card:):</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>titleTextNode.attributedString = NSAttributedString.attributedStringForTitleText(card.name)
</span></code></pre></td></tr></table></div></figure>


<p>è¿™è¡Œä»£ç ç»™titleTextNodeè®¾ç½®äº†å¯Œæ–‡æœ¬å†…å®¹ï¼Œ<code>attributedStringForTitleText(text:)</code>æ˜¯ä¸€ä¸ªå¸®åŠ©æ–¹æ³•è¢«åŠ åˆ°äº†NSAttributedStringæ‰©å±•å±æ€§ä¸­ã€‚åœ¨ä¹‹å‰çš„å¼€å§‹å·¥ç¨‹ä¸­ï¼Œå®ƒåˆ›å»ºäº†å¯Œæ–‡æœ¬ä½¿ç”¨æä¾›çš„æ ‡é¢˜ã€‚</p>

<p>ä¸‹ä¸€æ­¥ï¼Œåœ¨<code>buildSubnodeHierarchy():</code>çš„ç»“å°¾å¢åŠ å¦‚ä¸‹ä»£ç :</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>addSubnode(titleTextNode)</span></code></pre></td></tr></table></div></figure>


<p>è¦ç¡®ä¿å®ƒæ˜¯åœ¨æ·»åŠ åˆ°å›¾ç‰‡Nodeçš„åé¢ï¼Œä¸ç„¶å›¾ç‰‡å°†ä¼šé®ç›–ä½æ ‡é¢˜ã€‚</p>

<p>åœ¨å†…ç½®çš„æ–¹æ³•<code>calculateSizeThatFits(constrainedSize:)</code>ä¸­ï¼Œæ·»åŠ å¦‚ä¸‹ä»£ç :</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>titleTextNode.measure(cardSize)</span></code></pre></td></tr></table></div></figure>


<p>ä½¿ç”¨å­Nodeçš„æµ‹é‡å°ºå¯¸æ¥ä½œä¸ºå¡ç‰‡çš„çº¦æŸå°ºå¯¸</p>

<p>æ·»åŠ å¦‚ä¸‹çš„å¸ƒå±€ä»£ç layout():</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>titleTextNode.frame =
</span><span class='line'>  FrameCalculator.titleFrameForSize(titleTextNode.calculatedSize, containerFrame: imageNode.frame)
</span></code></pre></td></tr></table></div></figure>


<p>è¿™è¡Œä»£ç è®¡ç®—æ ‡é¢˜Nodeçš„frameé€šè¿‡å·¥å…·æ–¹æ³•FrameCalculator</p>

<p>ç¼–è¯‘è¿è¡Œ:
<img src="http://7xkxhx.com1.z0.glb.clouddn.com/ASDK_NodeHierarchies-7-281x500.jpg" alt="test" /></p>

<p>è‡³æ­¤ï¼Œä½ å·²ç»æ„å»ºäº†å®Œæ•´çš„å­Nodeå±‚æ¬¡ç»“æ„ï¼Œä½¿ç”¨äº†å®¹å™¨Node,å¹¶ä¸”æ·»åŠ äº†ä¸¤ä¸ªå­Node</p>

<h2>å®Œæ•´å·¥ç¨‹</h2>

<p><a href="https://github.com/TLSwiftDemo/Wonders/archive/master.zip">å®Œæ•´å·¥ç¨‹åœ¨è¿™é‡Œä¸‹è½½</a></p>

<p>have fun ğŸ˜€~</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">å®‰è·¯</span></span>

      




<time class='entry-date' datetime='2016-04-26T15:13:13+08:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>26</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>3:13 pm</span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/swift/'>swift</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  
  

<!-- JiaThis Button BEGIN -->
<div class="jiathis_style_32x32">
	<a class="jiathis_button_qzone"></a>
	<a class="jiathis_button_tsina"></a>
	<a class="jiathis_button_tqq"></a>
	<a class="jiathis_button_weixin"></a>
	<a class="jiathis_button_renren"></a>
	<a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	<a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js" charset="utf-8"></script>
<!-- JiaThis Button END -->
<br><br>
<!-- UY BEGIN -->
<div id="uyan_frame"></div>
<script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=2052593"></script>
<!-- UY END -->

</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2016/04/24/zi-ding-yi-colletionviewbu-ju/" title="Previous Post: è‡ªå®šä¹‰ColletionViewå¸ƒå±€">&laquo; è‡ªå®šä¹‰ColletionViewå¸ƒå±€</a>
      
      
        <a class="basic-alignment right" href="/blog/2016/04/28/viewcontrollerzhuan-chang-dong-hua/" title="Next Post: ViewControllerè½¬åœºåŠ¨ç”»">ViewControllerè½¬åœºåŠ¨ç”» &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
<h1>
	QQç¾¤
</h1>
   <br/>
	<p>æ¬¢è¿åŠ å…¥swiftå­¦ä¹ äº¤æµç¾¤:252710124</p>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2016/11/04/ioszhong-chang-jian-de-mian-shi-ti-er/">iOSä¸­å¸¸è§çš„é¢è¯•é¢˜äºŒ</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/11/03/ioszhong-chang-jian-de-mian-shi-ti-ji-da-an/">Iosä¸­å¸¸è§çš„é¢è¯•é¢˜åŠç­”æ¡ˆ</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/10/28/zi-ding-yi-uicollectionviewlayout/">è‡ªå®šä¹‰UICollectionViewLayout</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/10/24/ios10-uicollectionview-xin-te-xing/">Ios10 UICollectionView æ–°ç‰¹æ€§</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/10/17/ios10-usernotifications/">Ios10 UserNotifications</a>
      </li>
    
  </ul>
</section>
<section>
	<h1>æ–‡ç« åˆ†ç±»</h1>
	<ul id="categories">
		<li class='category'><a href='/blog/categories/cocoapods/'>cocoapods (1)</a></li>
<li class='category'><a href='/blog/categories/git/'>git (3)</a></li>
<li class='category'><a href='/blog/categories/ios/'>ios (27)</a></li>
<li class='category'><a href='/blog/categories/life/'>life (1)</a></li>
<li class='category'><a href='/blog/categories/mac/'>mac (2)</a></li>
<li class='category'><a href='/blog/categories/nodejs/'>nodejs (2)</a></li>
<li class='category'><a href='/blog/categories/octopress/'>octopress (2)</a></li>
<li class='category'><a href='/blog/categories/swift/'>swift (18)</a></li>
<li class='category'><a href='/blog/categories/xcode/'>xcode (1)</a></li>

	</ul>
</section>
<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/andrew-anlu">@andrew-anlu</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'andrew-anlu',
            count: 3,
            skip_forks: false,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>On Delicious</h1>
  <div id="delicious"></div>
  <script type="text/javascript" src="http://feeds.delicious.com/v2/json/Andrewswift1987?count=3&amp;sort=date&amp;callback=renderDeliciousLinks"></script>
  <p><a href="http://delicious.com/Andrewswift1987">My Delicious Bookmarks &raquo;</a></p>
</section>

 <section>
      <h1>è®¿å®¢ç»Ÿè®¡</h1>
      <br/>
    <a href="http://info.flagcounter.com/Bkif"><img src="http://s01.flagcounter.com/count2/Bkif/bg_ffffff/txt_000000/border_CCCCCC/columns_3/maxflags_10/viewers_0/labels_1/pageviews_1/flags_1/percent_0/" alt="Free counters!" border="0"></a>
    </section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><!--è¿”å›é¡¶éƒ¨å¼€å§‹-->
<div id="full" style="width:0px; height:0px; position:fixed; right:180px; bottom:150px; z-index:100; text-align:center; background-color:transparent; cursor:pointer;">
  <a href="#" onclick="goTop();return false;"><img src="http://7xsn4e.com2.z0.glb.clouddn.com/top.png" border=0 alt="è¿”å›é¡¶éƒ¨" width="50" height="50"></a>
</div>
<script src="/javascripts/top.js" type="text/javascript"></script>
<!--è¿”å›é¡¶éƒ¨ç»“æŸ-->


<p>
  Copyright &copy; 2016 - å®‰è·¯ -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>



</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'Andrewswift1987';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://andrew-anlu.github.io/blog/2016/04/26/zi-ding-yi-asyncdisplaykit-node/';
        var disqus_url = 'http://andrew-anlu.github.io/blog/2016/04/26/zi-ding-yi-asyncdisplaykit-node/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
